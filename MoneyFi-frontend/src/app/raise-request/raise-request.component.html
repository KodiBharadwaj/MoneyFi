<!-- Floating particles -->
<div class="particles">
  <div class="particle" *ngFor="let particle of [1,2,3,4,5,6,7,8,9]"></div>
</div>

<!-- Navbar -->
<nav class="navbar">
  <span class="brand-name" (click)="navigateHeader('')" role="button" tabindex="0">
    <i class="fas fa-chart-pie"></i>
    MoneyFi
  </span>
  <span>
    <button class="btn-signup" (click)="navigateTo('/track-request')">Track your Requests</button>
  </span>
</nav>

<!-- Main Container -->
<div class="main-container">
  <div class="request-container">
    <!-- Header Section -->
    <div class="header-section">
      <h1>Account Services</h1>
      <p>Manage your account requests with ease</p>
    </div>

    <!-- Progress Steps -->
    <div class="progress-steps">
      <div class="step" [class.active]="currentStep === 1" [class.completed]="currentStep > 1">
        <div class="step-circle">1</div>
        <div class="step-label">Select Service</div>
      </div>
      <div class="step" [class.active]="currentStep === 2" [class.completed]="currentStep > 2">
        <div class="step-circle">2</div>
        <div class="step-label">Request Details</div>
      </div>
      <div class="step" [class.active]="currentStep === 3" [class.completed]="currentStep > 3">
        <div class="step-circle">3</div>
        <div class="step-label">Submit</div>
      </div>
    </div>

    <!-- Tabs -->
    <div class="tab-buttons">
      <button 
        [class.active]="selectedTab === 'unblock'" 
        (click)="selectTab('unblock')">
        <i class="fas fa-unlock"></i>
        Account Unblock
      </button>
      <button 
        [class.active]="selectedTab === 'retrieve'" 
        (click)="selectTab('retrieve')">
        <i class="fas fa-redo"></i>
        Account Retrieve
      </button>
      <button 
        [class.active]="selectedTab === 'rename'" 
        (click)="selectTab('rename')">
        <i class="fas fa-edit"></i>
        Name Change
      </button>
    </div>

    <!-- Email Section -->
    <div class="form-section" *ngIf="!referenceNumberSent && !skippedToForm">
      <div class="section-title">
        <i class="fas fa-envelope"></i>
        Enter Your Email
      </div>
      
      <div class="input-group">
        <!-- <label for="email">Email Address</label> -->
        <div class="input-wrapper">
          <i class="fas fa-envelope"></i>
          <input 
            type="email" 
            id="email" 
            [(ngModel)]="email" 
            placeholder="Enter your email address" 
            required>
        </div>
      </div>

      <button 
        class="btn btn-primary btn-full" 
        (click)="sendReference()" 
        [disabled]="loading">
        <div class="spinner" *ngIf="loading"></div>
        <i class="fas fa-paper-plane" *ngIf="!loading"></i>
        {{ loading ? 'Sending...' : 'Send Reference Number' }}
      </button>

      <!-- Already Have Reference Section -->
      <div class="already-have-ref">
        <p><i class="fas fa-info-circle"></i> Already have a reference number?</p>
        <button class="btn btn-secondary" (click)="skipToRequestForm()">
          <!-- <i class="fas fa-arrow-right"></i> -->
          Skip to Request Details
        </button>
      </div>
    </div>

    <!-- Reference Number Display -->
    <div class="reference-display" *ngIf="referenceNumberSent && !showRequestForm">
      <i class="fas fa-check-circle"></i>
      <span>Reference number sent to your email! Check your inbox and enter the details below.</span>
    </div>

    <!-- Request Form -->
    <div class="form-section" *ngIf="showRequestForm">
      <div class="section-title">
        <i [class]="getFormIcon()"></i>
        <span>{{ getFormTitle() }}</span>
      </div>

      <form (ngSubmit)="submitRequest()">
        <!-- Email field for skipped users -->
        <div class="input-group" *ngIf="skippedToForm">
          <label for="requestEmail">Email Address</label>
          <div class="input-wrapper">
            <i class="fas fa-envelope"></i>
            <input 
              type="email" 
              id="requestEmail" 
              [(ngModel)]="requestData.email" 
              name="requestEmail" 
              placeholder="Enter your email address" 
              required>
          </div>
        </div>

        <!-- Unblock/Retrieve Form -->
        <ng-container *ngIf="selectedTab === 'unblock' || selectedTab === 'retrieve'">

          <div class="input-group">
            <label for="name">Full Name</label>
            <div class="input-wrapper">
              <i class="fas fa-user"></i>
              <input 
                type="text" 
                id="name" 
                [(ngModel)]="requestData.name" 
                name="name" 
                placeholder="Enter your full name" 
                required>
            </div>
          </div>
          
          <div class="input-group">
            <label for="description">Reason</label>
            <div class="input-wrapper">
              <select 
                id="description" 
                [(ngModel)]="requestData.description" 
                name="description" 
                required>
                <option *ngFor="let r of (selectedTab === 'unblock' ? unblockReasons : retrievalReasons)" [value]="r">
                  {{ r }}
                </option>
                <option value="Other">Other</option>
              </select>
            </div>
          </div>

          <!-- Show extra description only if Other -->
          <div class="input-group" *ngIf="requestData.description === 'Other'">
            <label for="customReason">Custom Reason</label>
            <div class="input-wrapper textarea-wrapper">
              <textarea 
                id="customReason" 
                [(ngModel)]="requestData.customReason" 
                name="customReason" 
                placeholder="Enter your custom reason"
                required></textarea>
            </div>
          </div>

          <div class="input-group">
            <label for="reference">Reference Number</label>
            <div class="input-wrapper">
              <!-- <i class="fas fa-hashtag"></i> -->
              <input 
                type="text" 
                id="reference" 
                [(ngModel)]="requestData.referenceNumber" 
                name="reference" 
                placeholder="Enter reference number from email" 
                required>
            </div>
          </div>

        </ng-container>

          
          

        <!-- Rename Form -->
        <ng-container *ngIf="selectedTab === 'rename'">
          <div class="input-group">
            <label for="oldName">Current Name</label>
            <div class="input-wrapper">
              <i class="fas fa-user"></i>
              <input 
                type="text" 
                id="oldName" 
                [(ngModel)]="requestData.oldName" 
                name="oldName" 
                placeholder="Enter your current name" 
                required>
            </div>
          </div>
          
          <div class="input-group">
            <label for="newName">New Name</label>
            <div class="input-wrapper">
              <i class="fas fa-user-edit"></i>
              <input 
                type="text" 
                id="newName" 
                [(ngModel)]="requestData.newName" 
                name="newName" 
                placeholder="Enter your new name" 
                required>
            </div>
          </div>

          <div class="input-group">
            <label for="description">Reason</label>
            <div class="input-wrapper">
              <select 
                id="description" 
                [(ngModel)]="requestData.description" 
                name="description" 
                required>
                <option *ngFor="let r of nameChangeReasons" [value]="r">
                  {{ r }}
                </option>
                <option value="Other">Other</option>
              </select>
            </div>
          </div>

          <!-- Show extra description only if Other -->
          <div class="input-group" *ngIf="requestData.description === 'Other'">
            <label for="customReason">Custom Reason</label>
            <div class="input-wrapper textarea-wrapper">
              <textarea 
                id="customReason" 
                [(ngModel)]="requestData.customReason" 
                name="customReason" 
                placeholder="Enter your custom reason"
                required></textarea>
            </div>
          </div>
          
          <div class="input-group">
            <label for="renameReference">Reference Number</label>
            <div class="input-wrapper">
              <i class="fas fa-hashtag"></i>
              <input 
                type="text" 
                id="renameReference" 
                [(ngModel)]="requestData.referenceNumber" 
                name="renameReference" 
                placeholder="Enter reference number from email" 
                required>
            </div>
          </div>
        </ng-container>

        <button type="submit" class="btn btn-primary btn-full">
          <i class="fas fa-check"></i>
          Submit Request
        </button>
      </form>
    </div>
  </div>
</div>